## 비디오 가게 TDD 연습
[테스트 주도 개발 : 고품질 쾌속개발을 위한 TDD실천법과 도구](http://www.yes24.com/24/goods/3908398) 10장 실습 예제 비디오 가게 TDD 연습

### 목적
비디오 가게에서 고객이 대여하는 비디오의 대여정보를 조회할 수 있는 프로그램을 작성해본다.

### 요구사항
- 고객은 이름을 갖는다.
- 고객은 한 번에 여러 개의 비디오를 대여할 수 있으나 각각의 대여기간은 다를 수 있다.
- 비디오는 영화, 스포츠, 다큐멘터리의 세 종류가 있다.
- 각 비디오는 독립적인 일일 대여요금을 갖는다.
- 영화는 대여기간이 2일 이상 되면 3일째부터는 대여요금이 1/2로 할인된다.
- 다큐멘터리는 3일 이상 대여하면 4일째부터는 1/3로 할인된다.
- 스포츠는 장기대여 할인이 없다.
- 비디오 1개 대여할 때마다 보너스 포인트는 1포인트씩 올라간다. 단, 스포츠는 2포인트씩 올라간다.
- 과거의 대여기록을 보유하고 있을 필요는 없으나 고객이 얻은 총 보너스 포인트 정보는 알고 있어야 한다.
- 고객의 현재 대여 정보를 구할 수 있는 기능을 작성하라
  - 총 대여비디오 수
  - 대여정보 : 비디오(종류+제목+가격), 대여기간 리스트
  - 총 대여가격
  - 현재 대여하고 있는 비디오로 인해 추가된 포인트


#### 요구사항 정련 규칙

>
- 하나의 목적을 갖는 의미나 동작으로 최대한 간결히 표현한다.
- '업무 규칙'과 '기능 요구사항'을 분리한다.
이 때 종류 중 하나를 나타낼 때는 어떤(any)으로 치환해 표현하는 것도 때로 도움이 된다.
- 행동의 주체를 가급적 명확히 표현한다.
- 동작과 소유를 분리한다.
예) 객체의 동작인가? 객체의 소유인가?
- 복잡 한자어는 유심히 봐서 분리 가능한지 확인해서 풀어쓰면 더 좋다.
예) 대여요금 -> 대여 행위 시에 발생하는 요금
- 상호 작용을 유심히 관찰한다.
예) 시스템의 행위인가? 고객의 행위인가?
- 구어체는 좀 더 명확한 의미를 가진 문어체로 변경한다.
예) 구한다 -> 화면에 보여준다. 계산한다. 저장한다.
  올라간다 -> 증가한다. 누적된다.


이를 기반으로 요구사항을 정련해본다.
1. 고객은 한 번에 여러 개의 비디오를 대여할 수 있으나 각 대여기간은 다를 수 있다.
*업무규칙*
  - 고객은 한 번에 여러 개의 비디오를 대여할 수 있다.
  - 대여기간은 비디오마다 각각 다를 수 있다.
2. 비디오는 영화, 스포츠, 다큐멘터리의 세 종류가 있다.
*업무규칙*
  - 비디오에는 종류가 있다.
  - 현재 비디오의 종류는 영화, 스포츠, 다큐멘터리의 세종류다.
3. 영화는 대여기간이 2일 이상되면 3일째부터는 대여요금이 1/2로 할인된다.
*업무규칙*
  - 영화는 대여기간이 n일 이상이 되면 m일째부터는 대여요금이 p로 할인된다.


개발에 필요한 클래스를 정련된 요구사항 목록으로부터 도출해보기

#### 행위 기반 클래스 도출
- 대여한다(고객이 비디오를)
- 할인된다(비디오 일일 대여가격이) -> 할인한다(시스템이 비디오 일일 대여가격을)
- 누적된다(보너스 포인트가) -> 누적한다(시스템이 포인트를)
- 계산한다(시스템이 포인트 총합을)
- 계산한다(시스템이 총 대여가격을)
- 계산한다(시스템이 총 대여비디오 수를)
- 제공한다(시스템이 대여정보를)


1. 수동 액션을 당하는 행위를 능동으로 바꿔보자. 행위의 주체가 시스템이라는걸 자연스럽게 알 수 있다.
2. 대여라는 행위를 하나의 추상 개념으로 구분하지 않고 고객이 영화를 직접 다루는 '고객 -> 영화' 식으로 설계할 수 도 있는데, 이러면 대여영화별 대여일자 정보를 같이 다루기가 어려워진다. 따라서 고객은 대여를 참조하고, 대여는 영화를 포함하는 식의 '고객 -> 대여 -> 영화' 같은 구성을 갖게 되면, 고객:대여=1:m, 대여:영화=1:1 관계를 통해 대여일수 관리가 가능해진다.

#### 소유 기반 클래스 도출
- 이름을 갖는다 (각 고객은)
- 종류를 갖는다 (각 비디오는)
- 대여요금을 갖는다 (각 비디오는)
- 포인트를 갖는다 (각 비디오) -> 포인트를 갖는다 -> (각 비디오 타입은)
- 대여일수를 갖는다 (비디오가? 고객이?) -> 대여일수를 갖는다 (각 대여는)


1. 소유기반 클래스를 살펴볼 때는 소유의 기준이 되는 조건이 무엇인지 생각해보아야 한다. 예를 들면 포인트 정보를 갖고 있어야 하는 것은 대여한 비디오(클래스)인가? 아니면, 대여한 비디오의 타입인가? 비디오가 포인트를 갖는다고 생각하기 쉽지만, 사실 부여되는 포인트는 비디오가 어떤 타입을 갖느냐에 달려 있다. 스포츠 타입인가? 아니면 다큐멘터리 타입인가? 하는 식으로 말이다.

2. 대여일수 정보는 어디에 둘 것인가에 대한 고민이다. 어느 쪽 클래스에 놓을지 애매할 경우에는 객체의 구체적인 인스턴스를 예로 들어서 해당정보를 '갖고 있다'는 말이 적당한지 테스트 해본다.
예) 타이타닉은 대여일수를 갖고 있다.(타이타닉의 대여일이 고정?)
   장동건은 대여일수를 갖고 있다.(장동건은 7일?)
이런식으로 따져보면, 비디오도, 고객도 대여일수는 갖는 모습이 어색하다는 것을 알 수 있다. 대여라는 추상적인 개념이 이 부분에서 쓰이는 것이 적절해 보인다. 그리고 이때 클래스에 해당 정보가 위치해야 하는 이유를 함께 생각해볼 필요가 있다. 예를 들자면 '대여일수를 갖는다' -> 대여일수로 대체 뭘 하려고 하는가? -> 대여가격과 포인트를 계산하려고 하는 식으로 말이다.


이제 각 클래스에 대한 테스트 케이스를 만드는 식으로 구현에 들어가면 좀 더 쉽게 작업할 수 있다. 이 때 시작은 소유 기반 클래스부터, 그리고 다른 클래스에 대한 의존성이 낮은 클래스부터 시작하는 걸 권장한다. 행위 기반 클래스들은 이런저런 클래스를 함꼐 이용해야 하는 경우가 많다.

#### 계획
- 정련된 요구사항 기능 구현
- 리팩토링
- 객체지향 생활체조 원칙 적용
- 설계된 도메인 -> JPA 적용해보기
